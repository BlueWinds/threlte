<script lang="ts">
  import { Canvas } from '@threlte/core'
  import { reducedMotion } from 'svelte-reduced-motion'
  import { NoToneMapping } from 'three'
  import { c } from '../../lib/classes'
  import Scene from './Scene.svelte'
  import { Sequence, Theatre } from '@threlte/theatre'
  import TheatreTextBox from './TheatreTextBox.svelte'
  import state from './state.json'

  let debug = false

  let started = false
</script>

<svelte:window
  on:keypress={(e) => {
    if (e.key === 'd') {
      debug = !debug
    }
  }}
/>

<Theatre
  config={{ state }}
  studio={{ enabled: false }}
>
  <div class={c('absolute top-0 left-0 z-[9] h-[110lvh] w-full')}>
    <div class="absolute inset-0">
      {#if $reducedMotion}
        <img
          class="h-full w-full object-cover"
          src="/images/hackathon/reduced-motion-background.jpg"
          alt="background"
        />
      {:else}
        <Canvas
          toneMapping={NoToneMapping}
          rendererParameters={{
            powerPreference: 'high-performance',
            antialias: false,
            stencil: false,
            depth: false,
            premultipliedAlpha: false
          }}
        >
          <Scene
            {debug}
            on:loaded={() => {
              started = true
            }}
          />
        </Canvas>
      {/if}
    </div>

    <div class="gradient absolute bottom-0 left-0 h-[10lvh] w-full" />

    {#if !debug && started}
      <Sequence
        autoplay
        delay={1000}
      >
        <div
          class="absolute inset-0 bottom-[10lvh] flex flex-col items-center justify-center gap-16 px-4"
        >
          <TheatreTextBox key="warp">
            <div class="flex flex-col items-center justify-center gap-3">
              <svg
                class="hidden max-w-[200px] sm:block"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 1256.5 258.35"
              >
                <g fill="#fff">
                  <path
                    d="M562.42 80.95c-21.36 0-38.93 7.23-55.12 23.43V16.87h-32.38v187.78c-13.35 9.15-25.12 13.42-37.55 13.42-21.36 0-32.38-12.06-32.38-34.8v-75.45h54.16V84.39h-54.16v-59.6L372.61 42.7v41.69h-28.92v23.43h28.92v77.52c0 35.14 20.67 56.15 60.98 56.15 15.12 0 28.52-3.06 41.34-9.58v6.13h32.38V128.83c15.16-16.88 29.97-24.46 47.89-24.46 22.74 0 33.42 11.37 33.42 35.14v98.53H621V137.1c0-36.17-20.67-56.16-58.57-56.16Z"
                  />
                  <path
                    d="M819.33 80.95c-18.87 0-35.72 5.24-49.26 14.38-11.38-10.05-24.8-14.38-42.37-14.38-24.8 0-43.75 8.61-59.6 28.25-.69-8.61-2.07-16.88-3.79-24.8h-31.69c2.41 9.99 3.44 21.36 3.44 36.52v117.13h32.38V136.76c14.81-22.39 30.66-32.38 50.3-32.38 12.62 0 22.09 3.35 30.72 11.49-8.62 12.76-13.5 28.37-13.5 45.7 0 47.89 35.83 79.93 89.23 79.93 25.84 0 48.23-7.24 68.9-22.39l-12.75-19.29c-16.88 12.75-34.79 18.6-55.12 18.6-33.76 0-54.09-17.91-57.19-49.61h128.16c.69-3.1 1.03-7.24 1.03-11.71 0-44.44-33.07-76.14-78.89-76.14Zm-49.61 66.83c4.13-27.22 21.7-44.1 48.58-44.1s44.1 16.88 47.54 44.1h-96.12Z"
                  />
                  <path
                    d="M1056 218.06c-21.36 0-32.38-12.06-32.38-34.8v-75.45h54.16V84.38h-54.16V24.79L991.24 42.7v41.69h-28.92v23.43h28.92v77.52c0 10.44 1.84 19.62 5.46 27.38-7.94 3.62-15.46 5.35-23.37 5.35-21.36 0-32.04-12.06-32.04-34.8V16.87h-95.77V40.3h63.39v145.04c0 35.14 20.33 56.15 60.63 56.15 15.76 0 29.45-3.13 42.83-10.3 9.88 6.7 23.18 10.3 39.85 10.3 20.33 0 37.55-5.51 54.43-17.57l-12.06-19.98c-13.78 9.65-25.84 14.13-38.59 14.13Z"
                  />
                  <path
                    d="M1256.5 157.08c0-44.44-33.07-76.14-78.89-76.14-48.23 0-83.37 34.11-83.37 80.62s35.83 79.93 89.23 79.93c25.84 0 48.23-7.24 68.9-22.39l-12.75-19.29c-16.88 12.75-34.8 18.6-55.12 18.6-33.76 0-54.09-17.91-57.19-49.61h128.16c.69-3.1 1.03-7.24 1.03-11.71Zm-128.5-9.3c4.13-27.22 21.7-44.1 48.58-44.1s44.1 16.88 47.54 44.1H1128Z"
                  />
                </g>
                <path
                  d="M0 140.99c22.81-8.91 45.61-17.82 68.44-26.74V26.62c1-.4 46.07-18.02 67.64-26.46.56-.22 1.03-.22 1.58 0 22.25 8.71 67.32 26.33 67.64 26.47v87.61c22.84 8.92 45.65 17.84 68.47 26.75v90.59c-.22.1-.44.2-.67.29-22.4 8.75-44.8 17.51-67.19 26.27-.45.18-.8.11-1.22-.05-22.33-8.73-44.66-17.45-66.98-26.19-.62-.24-1.12-.22-1.73.02-22.28 8.72-44.56 17.42-66.84 26.13-.26.1-.52.19-.79.29-22.78-8.9-45.55-17.8-68.36-26.71v-90.66Zm200.49 105.94v-73.29c-19.55-7.64-39.11-15.28-58.77-22.96v73.29c19.54 7.64 39.09 15.27 58.77 22.96Zm-68.51-22.95v-73.29c-19.65 7.68-39.21 15.32-58.72 22.94-.2 1.66-.11 72.67.1 73.25 19.53-7.63 39.05-15.26 58.62-22.9Zm-.39-89.82v-76.6c-18.22-7.12-36.39-14.22-54.65-21.35v76.59c18.18 7.1 36.36 14.21 54.65 21.35Zm65.22-97.95c-18.31 7.15-36.49 14.26-54.67 21.36v76.59c18.29-7.15 36.49-14.26 54.67-21.36V36.2Zm-47.44 105.16v.18c19.54 7.64 39.09 15.27 58.65 22.92 16.98-6.63 33.94-13.26 50.91-19.89 0-.06-.01-.12-.02-.19-19.55-7.64-39.09-15.27-58.63-22.91-16.99 6.64-33.95 13.27-50.91 19.89Zm-134.7 3.11c.36.16.58.27.81.36 16.47 6.44 32.95 12.87 49.42 19.32.59.23 1.08.21 1.65-.01 8.38-3.29 16.77-6.57 25.16-9.85 10.65-4.16 21.29-8.32 31.94-12.47.24-.09.47-.21.84-.38-.44-.18-.72-.3-1-.41-16.45-6.43-32.9-12.85-49.34-19.3-.51-.2-.93-.18-1.43.02-19.06 7.46-38.12 14.9-57.17 22.34-.25.1-.49.22-.86.38Z"
                  fill="#fff"
                />
              </svg>
              <svg
                class="w-[60px] sm:hidden"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 273.77 258.35"
              >
                <path
                  d="M0 140.99c22.81-8.91 45.61-17.82 68.44-26.74V26.62c1-.4 46.07-18.02 67.64-26.46.56-.22 1.03-.22 1.58 0 22.25 8.71 67.32 26.33 67.64 26.47v87.61c22.84 8.92 45.65 17.84 68.47 26.75v90.59c-.22.1-.44.2-.67.29-22.4 8.75-44.8 17.51-67.19 26.27-.45.18-.8.11-1.22-.05-22.33-8.73-44.66-17.45-66.98-26.19-.62-.24-1.12-.22-1.73.02-22.28 8.72-44.56 17.42-66.84 26.13-.26.1-.52.19-.79.29-22.78-8.9-45.55-17.8-68.36-26.71v-90.66Zm200.49 105.94v-73.29c-19.55-7.64-39.11-15.28-58.77-22.96v73.29c19.54 7.64 39.09 15.27 58.77 22.96Zm-68.51-22.95v-73.29c-19.65 7.68-39.21 15.32-58.72 22.94-.2 1.66-.11 72.67.1 73.25 19.53-7.63 39.05-15.26 58.62-22.9Zm-.39-89.82v-76.6c-18.22-7.12-36.39-14.22-54.65-21.35v76.59c18.18 7.1 36.36 14.21 54.65 21.35Zm65.22-97.95c-18.31 7.15-36.49 14.26-54.67 21.36v76.59c18.29-7.15 36.49-14.26 54.67-21.36V36.2Zm-47.44 105.16v.18c19.54 7.64 39.09 15.27 58.65 22.92 16.98-6.63 33.94-13.26 50.91-19.89 0-.06-.01-.12-.02-.19-19.55-7.64-39.09-15.27-58.63-22.91-16.99 6.64-33.95 13.27-50.91 19.89Zm-134.7 3.11c.36.16.58.27.81.36 16.47 6.44 32.95 12.87 49.42 19.32.59.23 1.08.21 1.65-.01 8.38-3.29 16.77-6.57 25.16-9.85 10.65-4.16 21.29-8.32 31.94-12.47.24-.09.47-.21.84-.38-.44-.18-.72-.3-1-.41-16.45-6.43-32.9-12.85-49.34-19.3-.51-.2-.93-.18-1.43.02-19.06 7.46-38.12 14.9-57.17 22.34-.25.1-.49.22-.86.38Z"
                  fill="#fff"
                />
              </svg>

              <svg
                class="w-full max-w-[500px] sm:w-[70vw] md:w-[55vw] xl:max-w-[550px]"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 1673.5099 290.2"
              >
                <g
                  id="g3"
                  transform="translate(-265.8,-178.22)"
                  style="fill:#ffffff"
                >
                  <polygon
                    class="cls-1"
                    points="619.85,291.03 694.35,178.23 626.21,178.23 546.48,178.23 476.74,178.23 552.69,292.49 481.66,402.87 335.55,178.23 265.8,178.23 457.22,466.19 458.71,468.42 502.68,468.42 585.89,342.44 669.64,468.42 713.62,468.42 905.29,178.23 837.15,178.23 692.6,402.87 "
                    id="polygon1"
                    style="fill:#ffffff"
                  />
                  <polygon
                    class="cls-1"
                    points="859.3,468.42 1149.97,468.42 1219.3,468.42 1027.63,178.23 983.66,178.23 790.75,468.42 "
                    id="polygon2"
                    style="fill:#ffffff"
                  />
                  <path
                    class="cls-1"
                    d="m 1834.41,178.23 h -222.7 v 290.19 h 62.93 V 364.94 h 159.77 c 69.6,0 104.9,-22.04 104.9,-65.5 v -55.72 c 0,-43.46 -35.29,-65.5 -104.9,-65.5 z"
                    id="path2"
                    style="fill:#ffffff"
                  />
                  <path
                    class="cls-1"
                    d="m 1462.11,178.23 h -222.7 v 290.19 h 62.93 V 364.94 h 128.92 l 66.41,103.48 h 69.34 l -69.84,-105.74 c 46.38,-6.62 69.84,-27.81 69.84,-63.24 v -55.72 c 0,-43.46 -35.29,-65.5 -104.9,-65.5 z"
                    id="path3"
                    style="fill:#ffffff"
                  />
                </g>
              </svg>
              <h1 class="text-center text-5xl font-bold">2023</h1>
            </div>
          </TheatreTextBox>

          <TheatreTextBox key="title">
            <h2 class="text-center text-3xl">
              The first official<br />
              Threlte hackathon<br />
              15-22 October 2023
            </h2>
          </TheatreTextBox>
        </div>
      </Sequence>

      <!-- ARROWS DOWN -->
      <div class="pointer-events-none absolute inset-0 flex items-end justify-center">
        <TheatreTextBox key="button">
          <button
            class="pointer-events-auto pb-[15lvh] outline-none"
            on:click={() => {
              window.scrollTo({
                top: window.innerHeight,
                behavior: 'smooth'
              })
            }}
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="32"
              height="32"
              class="pulse-1 -mb-[20px]"
              fill="#fff"
              viewBox="0 0 256 256"
            >
              <path
                d="M212.24,100.24l-80,80a6,6,0,0,1-8.48,0l-80-80a6,6,0,0,1,8.48-8.48L128,167.51l75.76-75.75a6,6,0,0,1,8.48,8.48Z"
              />
            </svg>

            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="32"
              height="32"
              class="pulse-2 -mb-[20px]"
              fill="#fff"
              viewBox="0 0 256 256"
            >
              <path
                d="M212.24,100.24l-80,80a6,6,0,0,1-8.48,0l-80-80a6,6,0,0,1,8.48-8.48L128,167.51l75.76-75.75a6,6,0,0,1,8.48,8.48Z"
              />
            </svg>

            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="32"
              height="32"
              class="pulse-3 -mb-[20px]"
              fill="#fff"
              viewBox="0 0 256 256"
            >
              <path
                d="M212.24,100.24l-80,80a6,6,0,0,1-8.48,0l-80-80a6,6,0,0,1,8.48-8.48L128,167.51l75.76-75.75a6,6,0,0,1,8.48,8.48Z"
              />
            </svg>
          </button>
        </TheatreTextBox>
      </div>
    {/if}
  </div>
</Theatre>

<style lang="postcss">
  .gradient {
    background: linear-gradient(transparent, ease, #0b0f18);
  }
</style>
